<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiling experiment</title>

    <style>
        :root {
            --primary-colour: #2A2C41,
            --secondary-colour: #2A2C41,
            --player-colour: #2A2C41
        }

        body {
            height: 100vw;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-sizing: border-box;
        }

        canvas {
            /* background: green; */
            border: 2px solid var(--primary-colour);
            border-radius: 5px;
            display: block;
            margin: 0 auto;
            margin-top: -2rem;
        }

        .restart-button {
            margin: 2rem auto;
            display: block;
        }

    </style>
</head>
<body>
   <canvas 
        id="game-space" 
        height="250" 
        width="250"
        data-pixel-size="10"></canvas> 
    <button class="restart-button">Restart</button>
   <script>
        const PRIMARY_COLOUR = '#8DA05E'
        const SECONDARY_COLOUR = '#E9EDE0'
        const PLAYER_COLOUR = '#2A2C41'
        const gameSpaceCanvas = document.querySelector('#game-space')
        const gameSpaceCanvasContext = gameSpaceCanvas.getContext('2d')
        const { height, width } = gameSpaceCanvas
        const pixelSize = parseInt(gameSpaceCanvas.dataset.pixelSize)
        const numberOfColums = width / pixelSize
        const numberOfRows = height / pixelSize
        let isFirstLoad = true

        // Bind reset button
        document.querySelector('.restart-button')
            .addEventListener('click', () => (isFirstLoad = true))

        function renderTiles() {
            if(height % pixelSize !== 0 || width % pixelSize !== 0) throw new Error('Provide a valid pixel size')
            const getFillColour = (i, j) => {
                const condition = j % 2 === 0

                if(i % 2 === 0) return condition ? PRIMARY_COLOUR: SECONDARY_COLOUR 
                return condition ? SECONDARY_COLOUR : PRIMARY_COLOUR
            }

            for(let i = 0; i <= numberOfRows; i++) {
                // Draw colums
                for(let j = 0; j <= numberOfColums; j++) {
                    const x = j * pixelSize
                    const y = i * pixelSize
                    const fillColour = getFillColour(i, j)
                    
                    gameSpaceCanvasContext.fillStyle = fillColour
                    gameSpaceCanvasContext.fillRect(x, y, pixelSize, pixelSize)
                }
            }
        }

        const Player = {
            fillColour: PLAYER_COLOUR,
            
            render() {
                if (isFirstLoad) {
                    const middleValue = ((numberOfColums - 1) / 2 ) 
                    this.x = middleValue * pixelSize
                    this.y = middleValue * pixelSize
                }

                gameSpaceCanvasContext.fillStyle = this.fillColour
                gameSpaceCanvasContext.fillRect(this.x, this.y, pixelSize, pixelSize)

                isFirstLoad = false
            }

        }

        const PlayerController = {
            register() {
                document.addEventListener('keydown', this.listener.bind(this))
            },

            listener({ key }) {
                switch (key) {
                    case 'w':
                        this.up()
                        break
                    case 'd':
                        this.right()
                        break
                    case 's':
                        this.down()
                        break
                    case 'a': 
                        this.left()
                        break
                }
            },

            up: () => {
                if (Player.y > 0) {
                    Player.y -= pixelSize
                }
            },

            down: () => {
                if(Player.y < height) {
                    Player.y += pixelSize
                }
            },

            left: () => {
                if (Player.x > 0) {
                    Player.x -= pixelSize
                }
            },

            right: () => {
                if(Player.y < width) {
                    Player.x += pixelSize
                }
            }
        }

        PlayerController.register()

        function main() {
            gameSpaceCanvasContext.beginPath()
            renderTiles()
            Player.render()
            gameSpaceCanvasContext.closePath()
            isFirstLoad = false
        }
        setInterval(main, 60)
   </script>
</body>
</html>

